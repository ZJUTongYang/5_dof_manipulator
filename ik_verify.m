clear, clc;

% 连杆参数，单位：mm
a1 = 3;
a2 = 96;
a3 = 96;

% 坐标系 {4} 的原点在基坐标系中的坐标
x = 100;
y = 100;
z = 28;

% 逆运动学的解
theta3 = [
    2*atan((-(2*x^2*y^2 + 2*x^2*z^2 + 2*y^2*z^2 + a1^4 + a2^4 + a3^4 + x^4 + y^4 + z^4 - 2*a1^2*a2^2 - 2*a1^2*a3^2 - 2*a2^2*a3^2 - 2*a1^2*x^2 - 2*a2^2*x^2 - 2*a3^2*x^2 - 2*a1^2*y^2 - 2*a2^2*y^2 - 2*a3^2*y^2 + 2*a1^2*z^2 - 2*a2^2*z^2 - 2*a3^2*z^2 + 8*a1*a2*a3*(x^2 + y^2)^(1/2))/((x^2 + y^2)*(- 2*a1^2 - 2*a2^2 + 4*a2*a3 - 2*a3^2 + x^2 + y^2 + 2*z^2) - 4*a2*a3^3 - 4*a2^3*a3 + a1^4 + a2^4 + a3^4 + z^4 - 2*a1^2*a2^2 - 2*a1^2*a3^2 + 6*a2^2*a3^2 + 2*a1^2*z^2 - 2*a2^2*z^2 - 2*a3^2*z^2 + 4*a1^2*a2*a3 + 4*a2*a3*z^2))^(1/2));
    2*atan(((2*a1^2*a2^2 - 2*x^2*z^2 - 2*y^2*z^2 - a1^4 - a2^4 - a3^4 - x^4 - y^4 - z^4 - 2*x^2*y^2 + 2*a1^2*a3^2 + 2*a2^2*a3^2 + 2*a1^2*x^2 + 2*a2^2*x^2 + 2*a3^2*x^2 + 2*a1^2*y^2 + 2*a2^2*y^2 + 2*a3^2*y^2 - 2*a1^2*z^2 + 2*a2^2*z^2 + 2*a3^2*z^2 + 8*a1*a2*a3*(x^2 + y^2)^(1/2))/((x^2 + y^2)*(- 2*a1^2 - 2*a2^2 + 4*a2*a3 - 2*a3^2 + x^2 + y^2 + 2*z^2) - 4*a2*a3^3 - 4*a2^3*a3 + a1^4 + a2^4 + a3^4 + z^4 - 2*a1^2*a2^2 - 2*a1^2*a3^2 + 6*a2^2*a3^2 + 2*a1^2*z^2 - 2*a2^2*z^2 - 2*a3^2*z^2 + 4*a1^2*a2*a3 + 4*a2*a3*z^2))^(1/2));
    -2*atan((-(2*x^2*y^2 + 2*x^2*z^2 + 2*y^2*z^2 + a1^4 + a2^4 + a3^4 + x^4 + y^4 + z^4 - 2*a1^2*a2^2 - 2*a1^2*a3^2 - 2*a2^2*a3^2 - 2*a1^2*x^2 - 2*a2^2*x^2 - 2*a3^2*x^2 - 2*a1^2*y^2 - 2*a2^2*y^2 - 2*a3^2*y^2 + 2*a1^2*z^2 - 2*a2^2*z^2 - 2*a3^2*z^2 + 8*a1*a2*a3*(x^2 + y^2)^(1/2))/((x^2 + y^2)*(- 2*a1^2 - 2*a2^2 + 4*a2*a3 - 2*a3^2 + x^2 + y^2 + 2*z^2) - 4*a2*a3^3 - 4*a2^3*a3 + a1^4 + a2^4 + a3^4 + z^4 - 2*a1^2*a2^2 - 2*a1^2*a3^2 + 6*a2^2*a3^2 + 2*a1^2*z^2 - 2*a2^2*z^2 - 2*a3^2*z^2 + 4*a1^2*a2*a3 + 4*a2*a3*z^2))^(1/2));
    -2*atan(((2*a1^2*a2^2 - 2*x^2*z^2 - 2*y^2*z^2 - a1^4 - a2^4 - a3^4 - x^4 - y^4 - z^4 - 2*x^2*y^2 + 2*a1^2*a3^2 + 2*a2^2*a3^2 + 2*a1^2*x^2 + 2*a2^2*x^2 + 2*a3^2*x^2 + 2*a1^2*y^2 + 2*a2^2*y^2 + 2*a3^2*y^2 - 2*a1^2*z^2 + 2*a2^2*z^2 + 2*a3^2*z^2 + 8*a1*a2*a3*(x^2 + y^2)^(1/2))/((x^2 + y^2)*(- 2*a1^2 - 2*a2^2 + 4*a2*a3 - 2*a3^2 + x^2 + y^2 + 2*z^2) - 4*a2*a3^3 - 4*a2^3*a3 + a1^4 + a2^4 + a3^4 + z^4 - 2*a1^2*a2^2 - 2*a1^2*a3^2 + 6*a2^2*a3^2 + 2*a1^2*z^2 - 2*a2^2*z^2 - 2*a3^2*z^2 + 4*a1^2*a2*a3 + 4*a2*a3*z^2))^(1/2))
    ];
t3 = real(theta3(2));
s3 = sin(t3);
c3 = cos(t3);

theta2 = [
    2*atan(((- a1^4 + 2*a1^2*a2^2 + 4*a1^2*a2*a3*c3 + 2*a1^2*a3^2*c3^2 + 2*a1^2*a3^2*s3^2 + 2*a1^2*x^2 + 2*a1^2*y^2 + 2*a1^2*z^2 - a2^4 - 4*a2^3*a3*c3 - 6*a2^2*a3^2*c3^2 - 2*a2^2*a3^2*s3^2 + 2*a2^2*x^2 + 2*a2^2*y^2 + 2*a2^2*z^2 - 4*a2*a3^3*c3^3 - 4*a2*a3^3*c3*s3^2 + 4*a2*a3*c3*x^2 + 4*a2*a3*c3*y^2 + 4*a2*a3*c3*z^2 - a3^4*c3^4 - 2*a3^4*c3^2*s3^2 - a3^4*s3^4 + 2*a3^2*c3^2*x^2 + 2*a3^2*c3^2*y^2 + 2*a3^2*c3^2*z^2 + 2*a3^2*s3^2*x^2 + 2*a3^2*s3^2*y^2 + 2*a3^2*s3^2*z^2 - x^4 - 2*x^2*y^2 - 2*x^2*z^2 - y^4 - 2*y^2*z^2 - z^4)^(1/2) - 2*a1*a3*s3)/(- a1^2 + 2*a1*a2 + 2*a1*a3*c3 - a2^2 - 2*a2*a3*c3 - a3^2*c3^2 - a3^2*s3^2 + x^2 + y^2 + z^2));
    -2*atan(((- a1^4 + 2*a1^2*a2^2 + 4*a1^2*a2*a3*c3 + 2*a1^2*a3^2*c3^2 + 2*a1^2*a3^2*s3^2 + 2*a1^2*x^2 + 2*a1^2*y^2 + 2*a1^2*z^2 - a2^4 - 4*a2^3*a3*c3 - 6*a2^2*a3^2*c3^2 - 2*a2^2*a3^2*s3^2 + 2*a2^2*x^2 + 2*a2^2*y^2 + 2*a2^2*z^2 - 4*a2*a3^3*c3^3 - 4*a2*a3^3*c3*s3^2 + 4*a2*a3*c3*x^2 + 4*a2*a3*c3*y^2 + 4*a2*a3*c3*z^2 - a3^4*c3^4 - 2*a3^4*c3^2*s3^2 - a3^4*s3^4 + 2*a3^2*c3^2*x^2 + 2*a3^2*c3^2*y^2 + 2*a3^2*c3^2*z^2 + 2*a3^2*s3^2*x^2 + 2*a3^2*s3^2*y^2 + 2*a3^2*s3^2*z^2 - x^4 - 2*x^2*y^2 - 2*x^2*z^2 - y^4 - 2*y^2*z^2 - z^4)^(1/2) + 2*a1*a3*s3)/(- a1^2 + 2*a1*a2 + 2*a1*a3*c3 - a2^2 - 2*a2*a3*c3 - a3^2*c3^2 - a3^2*s3^2 + x^2 + y^2 + z^2))
    ];
t2 = real(theta2(2));
s2 = sin(t2);
c2 = cos(t2);

theta1 = [
    2*atan(((a1 - x + a2*c2 + a3*c2*c3 - a3*s2*s3)/(a1 + x + a2*c2 + a3*c2*c3 - a3*s2*s3))^(1/2));
    -2*atan(((a1 - x + a2*c2 + a3*c2*c3 - a3*s2*s3)/(a1 + x + a2*c2 + a3*c2*c3 - a3*s2*s3))^(1/2))
    ];
t1 = real(theta1(1));

% Robotics Toolbox for MATLAB
L1 = RevoluteMDH('alpha', 0, 'a', 0, 'd', 72);  %  加入沿 Z0 轴方向 72 mm 的偏移，为底座高度
L2 = RevoluteMDH('alpha', -pi/2, 'a', a1, 'd', 0);
L3 = RevoluteMDH('alpha', 0, 'a', a2, 'd', 0);
L4 = RevoluteMDH('alpha', 0, 'a', a3, 'd', 0);
L5 = RevoluteMDH('alpha', -pi/2, 'a', 0, 'd', 0);

arm = SerialLink([L1 L2 L3 L4 L5], 'name', 'Manipulator');
theta = [t1 t2 t3 -pi/2 0];
arm.plot(theta, 'workspace', [-400 400 -400 400 0 400]);
